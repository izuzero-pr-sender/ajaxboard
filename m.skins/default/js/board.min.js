/**
 * AJAXBoard XE Module Javascript
 * Copyright (C) 아약스보드. All rights reserved.
 **/
!function(e){AJAXBoardDocPlugin=xe.createPlugin("AJAXBoardDocPlugin",{init:function(e){e.registerPlugin(this);var t=[["clearCommentEditor","after",this.triggerClearCommentEditor],["events.connect","after",this.triggerConnect],["events.insertComment","before",this.triggerInsertComment],["events.deleteComment","before",this.triggerDeleteComment],["events.insertDocument","before",this.triggerDispDocumentList],["events.deleteDocument","before",this.triggerDispDocumentList],["events.insertComment","before",this.triggerDispDocumentList],["events.deleteComment","before",this.triggerDispDocumentList]];for(var n in t)e.insertTrigger(t[n][0],t[n][1],t[n][2])},triggerClearCommentEditor:function(){e("textarea#rText").val("")},triggerConnect:function(){var t=this;"function"==typeof completeInsertComment&&(completeInsertComment=function(){t.clearCommentEditor()}),"function"==typeof completeDeleteComment&&(completeDeleteComment=function(){}),"function"==typeof loadPage&&(oldLoadPage=loadPage,loadPage=function(e,t){oAJAXBoard.current_url=oAJAXBoard.current_url.setQuery("document_srl",e).setQuery("cpage",t),oldLoadPage(e,t)}),e("div.bd").on("click","span.auth a.de",function(){var t=e(this),n=t.attr("href");n.indexOf("#")>-1&&(n=n.substring(0,n.indexOf("#")));var r=n.getQuery("act"),i=n.getQuery("comment_srl");return i&&"dispBoardDeleteComment"==r?(oAJAXBoard.deleteComment(n,i),!1):void 0}).on("click","div.pn a.prev, div.pn a.next",function(){var t=e(this),n=t.attr("href");return n.indexOf("#")>-1&&(n=n.substring(0,n.indexOf("#"))),oAJAXBoardDocPlugin.dispDocumentListByPage(n.getQuery("page")),!1})},triggerInsertComment:function(t){return e("div.bd").length&&this.document_srl==t?void oAJAXBoardDocPlugin.dispComment():!1},triggerDeleteComment:function(t){return e("div.bd").length&&e("div[class^='comment_"+t+"']").length?void oAJAXBoardDocPlugin.dispComment():!1},triggerDispDocumentList:function(){oAJAXBoardDocPlugin.dispDocumentList()},dispComment:function(){var t=e("div.bd");if(!t.length)return!1;e("h3#clb").length||e("div#skip_co").after('<div class="hx h3"><h3 id="clb">댓글 <em>[1]</em></h3><button type="button" class="tg tgr" title="open/close"></button></div>');var n=oAJAXBoard.current_url;return loadPage(n.getQuery("document_srl"),n.getQuery("cpage"))},dispDocumentList:function(t){var n=e("div.bd");if(!n.length)return!1;this.oApp.startAjax();var r=this,i=this.oApp.getPagesHandler(t);return i.done(function(t){t=e("<div>").append(e.parseHTML(t)).find("div.bd");var n=e("div.bd"),r=(n.children("div.hx").children("h2"),n.children("ul.lt")),i=n.children("div.pn"),o=(t.children("div.hx").children("h2").html(),t.children("ul.lt").html()),c=t.children("div.pn").html();r.html(o),i.html(c)}).fail(function(e,t,n){try{console.error("%s: %s, %o",t,n,e)}catch(r){}}).always(function(){r.oApp.stopAjax()}),i},dispDocumentListByPage:function(e){var t=this;return this.dispDocumentList({page:e}).done(function(){t.oApp.current_url=t.oApp.current_url.setQuery("page",e)})}})}(jQuery),jQuery(function(){oAJAXBoardDocPlugin=new AJAXBoardDocPlugin(oAJAXBoard)});