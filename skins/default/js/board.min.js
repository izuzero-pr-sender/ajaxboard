/**
 * AJAXBoard XE Module Javascript
 * Copyright (C) 아약스보드. All rights reserved.
 **/
!function(e){AJAXBoardDocPlugin=xe.createPlugin("AJAXBoardDocPlugin",{init:function(e){e.registerPlugin(this);var t=[["events.connect","after",this.triggerConnect],["events.insertComment","before",this.triggerInsertComment],["events.deleteComment","before",this.triggerDeleteComment],["events.insertDocument","before",this.triggerDispDocumentList],["events.deleteDocument","before",this.triggerDispDocumentList],["events.insertComment","before",this.triggerDispDocumentList],["events.deleteComment","before",this.triggerDispDocumentList]];for(var n in t)e.insertTrigger(t[n][0],t[n][1],t[n][2])},triggerConnect:function(){var t=this;"function"==typeof completeInsertComment&&(completeInsertComment=function(){t.clearCommentEditor()}),"function"==typeof completeDeleteComment&&(completeDeleteComment=function(){}),e("div#comment").on("click","p.action a.delete",function(){var t=e(this),n=t.attr("href");n.indexOf("#")>-1&&(n=n.substring(0,n.indexOf("#")));var i=n.getQuery("act"),r=n.getQuery("comment_srl");return r&&"dispBoardDeleteComment"==i?(oAJAXBoard.deleteComment(n,r),!1):void 0}).on("click","div.pagination [href]",function(){var t=e(this),n=t.attr("href");n.indexOf("#")>-1&&(n=n.substring(0,n.indexOf("#")));var i=n.getQuery("cpage");return oAJAXBoardDocPlugin.dispCommentsByCpage(i>1&&t.hasClass("direction")?"":i),!1}),e("div.list_footer").on("click","div.pagination [href]",function(){var t=e(this),n=t.attr("href");return n.indexOf("#")>-1&&(n=n.substring(0,n.indexOf("#"))),oAJAXBoardDocPlugin.dispDocumentListByPage(n.getQuery("page")),!1})},triggerInsertComment:function(t){return e("div#comment").length&&this.document_srl==t?void oAJAXBoardDocPlugin.dispComment():!1},triggerDeleteComment:function(t){return e("div#comment").length&&e("#comment_"+t).length?void oAJAXBoardDocPlugin.dispComment():!1},triggerDispDocumentList:function(){oAJAXBoardDocPlugin.dispDocumentList()},dispComment:function(t){var n=e("div#comment");if(!n.length)return!1;this.oApp.startAjax();var i=this,r=this.oApp.getPagesHandler(t);return r.done(function(t){t=e("<div>").append(e.parseHTML(t)).find("div#comment");var n=e("div#comment"),i=n.children("div.fbHeader"),r=n.children("ul.fbList"),o=n.children("div.pagination"),s=t.children("div.fbHeader").html(),c=t.children("ul.fbList").html(),d=t.children("div.pagination").html();r.length?c||r.remove():i.after(e('<ul class="fbList">')),o.length?d||o.remove():d&&r.after(e('<div class="pagination">')),i=n.children("div.fbHeader"),r=n.children("ul.fbList"),o=n.children("div.pagination"),i.html(s),r.html(c),o.html(d)}).fail(function(e,t,n){try{console.error("%s: %s, %o",t,n,e)}catch(i){}}).always(function(){i.oApp.stopAjax()}),r},dispCommentsByCpage:function(e){var t=this;return this.dispComment({cpage:e}).done(function(){t.oApp.current_url=t.oApp.current_url.setQuery("cpage",e)})},dispDocumentList:function(t){var n=e("div.board");if(!n.length)return!1;this.oApp.startAjax();var i=this,r=this.oApp.getPagesHandler(t);return r.done(function(t){t=e("<div>").append(e.parseHTML(t)).find("div.board");var n=e("div.board"),i=n.children("div.board_list"),r=n.children("div.list_footer").children("div.pagination"),o=t.children("div.board_list").html(),s=t.children("div.list_footer").children("div.pagination").html();r.length?s||r.remove():s&&e("div.list_footer").prepend('<div class="pagination">'),r=n.children("div.list_footer").children("div.pagination"),i.html(o),r.html(s)}).fail(function(e,t,n){try{console.error("%s: %s, %o",t,n,e)}catch(i){}}).always(function(){i.oApp.stopAjax()}),r},dispDocumentListByPage:function(e){var t=this;return this.dispDocumentList({page:e}).done(function(){t.oApp.current_url=t.oApp.current_url.setQuery("page",e)})}})}(jQuery),jQuery(function(){oAJAXBoardDocPlugin=new AJAXBoardDocPlugin(oAJAXBoard)});